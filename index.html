<!DOCTYPE html>
<html lang="en">

<head>
  <title>PGP Encrypt Files</title>
  <script src="lib/openpgp.js"></script>
</head>

<body>
  <div id="container">
    <h1>
      PGP Encrypt Files
    </h1>
    <hr>

    <h3>Step 1</h3>
    <p>Put files into a directory/folder and compress it</p>

    <h3>Step 2</h3>
    <p>Upload the file by clicking "Browse..." and selecting it</p>

    <h3>Step 3</h3>
    <p>Click "Download" to encrypt and download the file</p>

    <form>
      <input type="file" id="file" name="filename">
    </form>

    <br />

    <form>
      <button type="button" onClick="return encryptAndDownload()">Download</button>
    </form>

  </div>
</body>

</html>

<script>
  checkIfFileAPISupported();

  downloadURL = function (url, fileName) {
    const a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    document.body.appendChild(a);
    a.style = 'display: none';
    a.click();
    a.remove();
  };

  function download(fileName, encryptedFile) {
    const blob = new Blob([encryptedFile], {
      type: 'application/octet-stream'
    });
    url = window.URL.createObjectURL(blob);
    downloadURL(url, fileName);
  }

  function checkIfFileAPISupported() {
    if (window.File && window.FileReader && window.FileList && window.Blob) {
      console.log("File API supported!");
    } else {
      console.log('The File API is not fully supported in this browser.');
    }
  }

  async function encryptAndDownload() {
    var fileInput = document.getElementById('file');
    var filePath = fileInput.value;
    var data = fileInput.files[0];
    const fileName = filePath.replace(/^.*[\\\/]/, '');

    const encryptedFile = await encryptFile(data);
    download(`${fileName}.pgp`, encryptedFile);
    document.getElementById("file").value = "";
  }

  var getArrayBuffer = (blob) => new Promise(function (resolve) {
    var reader = new FileReader();
    reader.onloadend = function () {
      resolve(reader.result);
    };
    reader.readAsArrayBuffer(blob);
  });

  async function encryptFile(data) {
    const publicKeysArmored = [
// IMPORTANT: Replace this public key with trusted keys
`-----BEGIN PGP PUBLIC KEY BLOCK-----

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
=d+u4
-----END PGP PUBLIC KEY BLOCK-----
`];

    const arrayBufferData = await getArrayBuffer(data)

    const publicKeys = await Promise.all(publicKeysArmored.map(armoredKey => openpgp.readKey({ armoredKey })));

    const encryptedFile = await openpgp.encrypt({
      message: await openpgp.createMessage({ binary: new Uint8Array(arrayBufferData) }),
      encryptionKeys: publicKeys,
      format: 'binary'
    })

    return encryptedFile;
  };
</script>

<style>
  body {
    width: 100%;
    margin: auto;
  }

  #container {
    padding: 30px;
  }
</style>
